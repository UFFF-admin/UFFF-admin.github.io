<html>
	<head prefix="og: http://ogp.me/ns#">
		<meta charset="utf-8">
		<meta property="og:description" content="統一友愛戦線 / United Front for Fraternity・旧荒らし賛美の会（Praise of Destruction Party / PODP）公式サイト">
		<meta property="og:site_name" content="UFFF公式サイト">
		<meta property="og:type" content="article">
		<meta property="og:image" content="https://ufff-jp.netlify.app/Flag_of_UFFF.png">
		<meta property="og:title" content="透かしの挿入">
		<title>透かしの挿入</title>
		<link rel="stylesheet" href="index.css">
	</head>
	<body>
		<div id="source">
			<h1>画像に透かしを入れる</h1>
			<p>
				<ul>
					<li>ファイルをアップロード</li>
					<li>「変換」をクリック</li>
					<li>ファイルをダウンロード</li>
				</ul>
				<hr>
				<input type="file" id="upload">または貼り付け<br>
				<input type="button" id="submit" value="変換"><br>
				<input type="button" id="download" value="ダウンロード"><br>
				プレビュー：<br>
				<img src="" id="preview">
			</p>
		</div>
		<script src="index.js"></script>
		<script>
            //0.02,0.15
let blob;
function id(id){
	return document.getElementById(id);
}
id("preview").width=id("content").offsetWidth*0.9;
id("submit").onclick=function(){
    let r=new FileReader();
    r.readAsDataURL(blob);
    r.onload=function(){
	    let img=new Image();
        let canvas=document.createElement("canvas");
        let ctx=canvas.getContext("2d");
        img.src=r.result;
        img.onload=function(){
            canvas.width=img.width;
            canvas.height=img.height;
            ctx.drawImage(img,0,0,canvas.width,canvas.height);
            let watermark=new Image();
            watermark.src="WaterMark_of_UFFF.svg";
			watermark.onload=function(){
				watermark.width=canvas.height*0.15;
				watermark.height=watermark.width;
				ctx.drawImage(watermark,canvas.width-watermark.width*1.14,watermark.height*0.14,watermark.width,watermark.height);
				let previewLink=canvas.toDataURL();
				id("preview").src=previewLink;
				id("download").onclick=function(){
					let a=document.createElement("a");
					a.download="";
					a.href=previewLink;
					a.click();
				}
			}
        }
    }
}
id("upload").onchange=function(){
    blob=id("upload").files[0];
}
document.onpaste=function(e){
    [...e.clipboardData.items].forEach(function(data){
        if(data.type.indexOf("image")==0){
            blob=data.getAsFile();
        }
    });
}
		</script>
	</body>
</html>
